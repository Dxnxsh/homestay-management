<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <title>Billing</title>
    <link rel="stylesheet" href="../css/billingStyle.css">
    <link href='https://cdn.boxicons.com/3.0.5/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <div class="sidebar close">
      <div class="logo-details">
        <img src="../images/logo.png" alt="Serena Sanctuary logo" class="logo-icon">
        <span class="logo_name">Serena Sanctuary</span>
      </div>
      <ul class="nav-links">
        <li>
          <a href="dashboard.html">
            <i class='bxr  bx-dashboard'></i>
            <span class="link_name">Dashboard</span>
          </a>
          <ul class="sub-menu blank">
            <li><a class="link_name" href="dashboard.html">Dashboard</a></li>
          </ul>
        </li>
        <li>
          <div class="icon-link">
            <a href="manage.html">
              <i class='bxr  bx-list-square'></i>
              <span class="link_name">Manage</span>
            </a>
            <i class='bx bxs-chevron-down arrow'></i>
          </div>
          <ul class="sub-menu">
            <li><a class="link_name" href="manage.html">Manage</a></li>
            <li><a href="guests.html">Guests</a></li>
            <li><a href="staff.html">Staff</a></li>
            <li><a href="homestay.html">Homestay</a></li>
          </ul>
        </li>
        <li>
          <a href="billing.html">
            <i class='bxr  bx-print-dollar'></i>
            <span class="link_name">Billing</span>
          </a>
          <ul class="sub-menu blank">
            <li><a class="link_name" href="billing.html">Billing</a></li>
          </ul>
        </li>
        <li>
          <a href="bookings.html">
            <i class='bxr  bx-home-add'></i>
            <span class="link_name">Bookings</span>
          </a>
          <ul class="sub-menu blank">
            <li><a class="link_name" href="bookings.html">Bookings</a></li>
          </ul>
        </li>
        <li>
          <a href="calendar.html">
            <i class='bxr  bx-calendar-alt'></i>
            <span class="link_name">Calendar</span>
          </a>
          <ul class="sub-menu blank">
            <li><a class="link_name" href="calendar.html">Calendar</a></li>
          </ul>
        </li>
        <li>
          <div class="icon-link">
            <a href="reports.html">
              <i class='bxr  bx-file-report'></i>
              <span class="link_name">Reports</span>
            </a>
            <i class='bx bxs-chevron-down arrow'></i>
          </div>
          <ul class="sub-menu">
            <li><a class="link_name" href="reports.html">Reports</a></li>
            <li><a href="fullReports.html">Full Reports</a></li>
            <li><a href="summary.html">Summary</a></li>
            <li><a href="analytics.html">Analytics</a></li>
          </ul>
        </li>
        <div class="profile-details">
          <div class="profile-content">
            <img src="../images/profile.png" alt="profileImg">
          </div>
          <div class="name-job">
            <div class="profile_name">Shafiq</div>
            <div class="job">Admin</div>
          </div>
          <i class='bxr  bx-arrow-out-left-circle-half'></i>
        </div>
      </ul>
    </div>

    <section class="home-section">
      <div class="home-content">
        <i class='bx bx-menu'></i>
        <span class="text">Serena Sanctuary</span>
      </div>
      <div class="page-heading">
        <h1>Billing</h1>
      </div>
      <!-- Content -->
      <div class="content">
        <div class="button-container">
          <div class="spinner-container">
            <div class="spinner-select-wrapper">
              <select class="spinner-select" id="sortOrder">
                <option value="">Select Order</option>
                <option value="ascending">Ascending</option>
                <option value="descending">Descending</option>
              </select>
            </div>
            <div class="spinner-select-wrapper">
              <select class="spinner-select" id="sortBy">
                <option value="">Sort By</option>
                <option value="date">By Date</option>
                <option value="amount">By Amount</option>
                <option value="status">By Status</option>
              </select>
            </div>
          </div>
          <form class="search-form">
            <div class="search-container">
              <div class="search-by">
                <select id="searchType" name="search-type">
                  <option value="billNo">Bill No.</option>
                  <option value="guestId">Guest ID</option>
                  <option value="staffId">Staff ID</option>
                  <option value="status">Status</option>
                </select>
              </div>
              <div class="search-input">
                <input id="search" type="text" placeholder="Search Bills" />
              </div>
              <div class="search-button">
                <button class="btn-search" type="button" aria-label="Search">
                </button>
              </div>
            </div>
          </form>
        </div>
        <div class="table-container">
          <table class="guests-table">
          <thead>
            <tr>
              <th>Bill No.</th>
              <th>Bill Date</th>
              <th>Total Amount</th>
              <th>Bill Status</th>
              <th>Payment Method</th>
              <th>Guest ID</th>
              <th>Staff ID</th>
              <th>Details</th>
              <th>Manage</th>
            </tr>
          </thead>
          <tbody id="billingTableBody">
            <tr data-date="2025-01-15" data-amount="1500" data-status="Paid" data-subtotal="1400" data-disc="50" data-tax="100" data-late="50" data-payment-date="2025-01-15">
              <td>B001</td>
              <td>2025-01-15</td>
              <td>RM 1,500</td>
              <td>
                <select class="status-select" onchange="quickChangeStatus('B001', this.value)">
                  <option value="Paid" selected>Paid</option>
                  <option value="Pending">Pending</option>
                </select>
              </td>
              <td>Bank in</td>
              <td>G001</td>
              <td>S001</td>
              <td>
                <button class="btn-details" onclick="viewBillDetails('B001')">Details</button>
              </td>
              <td>
                <button class="btn-update" onclick="updateBill('B001')">Update</button>
                <button class="btn-delete" onclick="deleteBill('B001')">Delete</button>
              </td>
            </tr>
            <tr data-date="2025-01-20" data-amount="1350" data-status="Pending" data-subtotal="1300" data-disc="30" data-tax="80" data-late="0" data-payment-date="">
              <td>B002</td>
              <td>2025-01-20</td>
              <td>RM 1,350</td>
              <td>
                <select class="status-select" data-status="Pending" style="background: #fff3e0; color: #ff9800;" onchange="quickChangeStatus('B002', this.value)">
                  <option value="Paid">Paid</option>
                  <option value="Pending" selected>Pending</option>
                </select>
              </td>
              <td>Cash</td>
              <td>G002</td>
              <td>S002</td>
              <td>
                <button class="btn-details" onclick="viewBillDetails('B002')">Details</button>
              </td>
              <td>
                <button class="btn-update" onclick="updateBill('B002')">Update</button>
                <button class="btn-delete" onclick="deleteBill('B002')">Delete</button>
              </td>
            </tr>
            <tr data-date="2025-01-25" data-amount="1200" data-status="Paid" data-subtotal="1150" data-disc="20" data-tax="70" data-late="0" data-payment-date="2025-01-25">
              <td>B003</td>
              <td>2025-01-25</td>
              <td>RM 1,200</td>
              <td>
                <select class="status-select" data-status="Paid" style="background: #e8f5e9; color: #00bf63;" onchange="quickChangeStatus('B003', this.value)">
                  <option value="Paid" selected>Paid</option>
                  <option value="Pending">Pending</option>
                </select>
              </td>
              <td>Bank in</td>
              <td>G003</td>
              <td>S001</td>
              <td>
                <button class="btn-details" onclick="viewBillDetails('B003')">Details</button>
              </td>
              <td>
                <button class="btn-update" onclick="updateBill('B003')">Update</button>
                <button class="btn-delete" onclick="deleteBill('B003')">Delete</button>
              </td>
            </tr>
            <tr data-date="2025-02-01" data-amount="1650" data-status="Pending" data-subtotal="1600" data-disc="40" data-tax="90" data-late="0" data-payment-date="">
              <td>B004</td>
              <td>2025-02-01</td>
              <td>RM 1,650</td>
              <td>
                <select class="status-select" data-status="Pending" style="background: #fff3e0; color: #ff9800;" onchange="quickChangeStatus('B004', this.value)">
                  <option value="Paid">Paid</option>
                  <option value="Pending" selected>Pending</option>
                </select>
              </td>
              <td>Cash</td>
              <td>G004</td>
              <td>S002</td>
              <td>
                <button class="btn-details" onclick="viewBillDetails('B004')">Details</button>
              </td>
              <td>
                <button class="btn-update" onclick="updateBill('B004')">Update</button>
                <button class="btn-delete" onclick="deleteBill('B004')">Delete</button>
              </td>
            </tr>
          </tbody>
          </table>
        </div>
      </div>
      <!-- Footer -->
      <footer class="footer">
        <div class="footer-content">
          <p>&copy; 2025 Serena Sanctuary. All rights reserved.</p>
        </div>
      </footer>
    </section>

    <!-- Bill Details Modal -->
    <div id="detailsModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Bill Details</h2>
          <span class="close-modal" onclick="closeDetailsModal()">&times;</span>
        </div>
        <div class="modal-form">
          <div class="form-group">
            <label>Bill No.</label>
            <input type="text" id="detailsBillNo" readonly>
          </div>
          <div class="form-group">
            <label>Bill Date</label>
            <input type="text" id="detailsBillDate" readonly>
          </div>
          <div class="form-group">
            <label>Bill Subtotal</label>
            <input type="text" id="detailsSubtotal" readonly>
          </div>
          <div class="form-group">
            <label>Discount Amount</label>
            <input type="text" id="detailsDiscAmount" readonly>
          </div>
          <div class="form-group">
            <label>Tax Amount</label>
            <input type="text" id="detailsTaxAmount" readonly>
          </div>
          <div class="form-group">
            <label>Late Charges</label>
            <input type="text" id="detailsLateCharges" readonly>
          </div>
          <div class="form-group">
            <label>Total Amount</label>
            <input type="text" id="detailsTotalAmount" readonly>
          </div>
          <div class="form-group">
            <label>Bill Status</label>
            <input type="text" id="detailsBillStatus" readonly>
          </div>
          <div class="form-group">
            <label>Payment Date</label>
            <input type="text" id="detailsPaymentDate" readonly>
          </div>
          <div class="form-group">
            <label>Payment Method</label>
            <input type="text" id="detailsPaymentMethod" readonly>
          </div>
          <div class="form-group">
            <label>Guest ID</label>
            <input type="text" id="detailsGuestId" readonly>
          </div>
          <div class="form-group">
            <label>Staff ID</label>
            <input type="text" id="detailsStaffId" readonly>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeDetailsModal()">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Update Bill Modal -->
    <div id="updateModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Update Bill Details</h2>
          <span class="close-modal" onclick="closeUpdateModal()">&times;</span>
        </div>
        <form id="updateBillForm" class="modal-form">
          <div class="form-group">
            <label for="updateBillNo">Bill No.</label>
            <input type="text" id="updateBillNo" name="billNo" readonly>
          </div>
          <div class="form-group">
            <label for="updateBillDate">Bill Date</label>
            <input type="date" id="updateBillDate" name="billDate" required>
          </div>
          <div class="form-group">
            <label for="updateSubtotal">Bill Subtotal</label>
            <input type="number" id="updateSubtotal" name="subtotal" required min="0" step="0.01">
          </div>
          <div class="form-group">
            <label for="updateDiscAmount">Discount Amount</label>
            <input type="number" id="updateDiscAmount" name="discAmount" required min="0" step="0.01">
          </div>
          <div class="form-group">
            <label for="updateTaxAmount">Tax Amount</label>
            <input type="number" id="updateTaxAmount" name="taxAmount" required min="0" step="0.01">
          </div>
          <div class="form-group">
            <label for="updateLateCharges">Late Charges</label>
            <input type="number" id="updateLateCharges" name="lateCharges" required min="0" step="0.01">
          </div>
          <div class="form-group">
            <label for="updateAmount">Total Amount</label>
            <input type="number" id="updateAmount" name="amount" required min="0" step="0.01" readonly>
          </div>
          <div class="form-group">
            <label for="updateStatus">Bill Status</label>
            <select id="updateStatus" name="status" required onchange="updateStatusInModal(this.value)">
              <option value="Paid">Paid</option>
              <option value="Pending">Pending</option>
            </select>
          </div>
          <div class="form-group">
            <label for="updatePaymentDate">Payment Date</label>
            <input type="date" id="updatePaymentDate" name="paymentDate">
          </div>
          <div class="form-group">
            <label for="updatePaymentMethod">Payment Method</label>
            <select id="updatePaymentMethod" name="paymentMethod" required>
              <option value="Cash">Cash</option>
              <option value="Bank in">Bank in</option>
              <option value="Credit Card">Credit Card</option>
              <option value="Online Transfer">Online Transfer</option>
            </select>
          </div>
          <div class="form-group">
            <label for="updateGuestId">Guest ID</label>
            <input type="text" id="updateGuestId" name="guestId" required>
          </div>
          <div class="form-group">
            <label for="updateStaffId">Staff ID</label>
            <input type="text" id="updateStaffId" name="staffId" required>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeUpdateModal()">Cancel</button>
            <button type="submit" class="btn-save">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      let arrow = document.querySelectorAll(".arrow");
      for (var i = 0; i < arrow.length; i++) {
        arrow[i].addEventListener("click", (e) => {
          let arrowParent = e.target.parentElement.parentElement;
          arrowParent.classList.toggle("showMenu");
        });
      }
      let sidebar = document.querySelector(".sidebar");
      let sidebarBtn = document.querySelector(".bx-menu");
      console.log(sidebarBtn);
      sidebarBtn.addEventListener("click", () => {
        sidebar.classList.toggle("close");
      });

      // Sorting functionality
      const sortOrderSelect = document.getElementById('sortOrder');
      const sortBySelect = document.getElementById('sortBy');
      const tableBody = document.getElementById('billingTableBody');

      function sortTable() {
        const sortBy = sortBySelect.value;
        const sortOrder = sortOrderSelect.value;

        if (!sortBy || !sortOrder) {
          return;
        }

        const rows = Array.from(tableBody.querySelectorAll('tr'));
        
        rows.sort((a, b) => {
          let comparison = 0;
          
          switch(sortBy) {
            case 'date':
              const dateA = new Date(a.getAttribute('data-date'));
              const dateB = new Date(b.getAttribute('data-date'));
              comparison = dateA - dateB;
              break;
            case 'amount':
              const amountA = parseFloat(a.getAttribute('data-amount'));
              const amountB = parseFloat(b.getAttribute('data-amount'));
              comparison = amountA - amountB;
              break;
            case 'status':
              const statusA = a.getAttribute('data-status');
              const statusB = b.getAttribute('data-status');
              comparison = statusA.localeCompare(statusB);
              break;
          }
          
          return sortOrder === 'ascending' ? comparison : -comparison;
        });

        tableBody.innerHTML = '';
        rows.forEach(row => tableBody.appendChild(row));
      }

      sortOrderSelect.addEventListener('change', sortTable);
      sortBySelect.addEventListener('change', sortTable);

      // Search functionality
      const searchInput = document.getElementById('search');
      const searchButton = document.querySelector('.btn-search');
      const searchTypeSelect = document.getElementById('searchType');
      let allRows = Array.from(tableBody.querySelectorAll('tr'));

      function performSearch() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        const searchType = searchTypeSelect.value;
        
        allRows.forEach(row => {
          let matches = false;
          
          if (searchType === 'billNo') {
            const billNo = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
            matches = billNo.includes(searchTerm);
          } else if (searchType === 'guestId') {
            const guestId = row.querySelector('td:nth-child(6)').textContent.toLowerCase();
            matches = guestId.includes(searchTerm);
          } else if (searchType === 'staffId') {
            const staffId = row.querySelector('td:nth-child(7)').textContent.toLowerCase();
            matches = staffId.includes(searchTerm);
          } else if (searchType === 'status') {
            const status = row.querySelector('td:nth-child(4)').textContent.toLowerCase();
            matches = status.includes(searchTerm);
          }
          
          row.style.display = matches ? '' : 'none';
        });
      }

      searchButton.addEventListener('click', performSearch);
      searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          performSearch();
        }
      });

      allRows = Array.from(tableBody.querySelectorAll('tr'));

      // Update and Delete functions
      function updateBill(billNo) {
        const rows = tableBody.querySelectorAll('tr');
        let targetRow = null;
        
        rows.forEach(row => {
          const idCell = row.querySelector('td:first-child');
          if (idCell && idCell.textContent.trim() === billNo) {
            targetRow = row;
          }
        });
        
        if (!targetRow) {
          alert('Bill not found!');
          return;
        }
        
        const cells = targetRow.querySelectorAll('td');
        const statusSelect = cells[3].querySelector('.status-select');
        const currentStatus = statusSelect ? statusSelect.value : cells[3].textContent.trim();
        
        const currentData = {
          billNo: cells[0].textContent.trim(),
          billDate: cells[1].textContent.trim(),
          amount: cells[2].textContent.trim().replace('RM ', '').replace(',', '').trim(),
          status: currentStatus,
          paymentMethod: cells[4].textContent.trim(),
          guestId: cells[5].textContent.trim(),
          staffId: cells[6].textContent.trim(),
          subtotal: targetRow.getAttribute('data-subtotal') || '0',
          discAmount: targetRow.getAttribute('data-disc') || '0',
          taxAmount: targetRow.getAttribute('data-tax') || '0',
          lateCharges: targetRow.getAttribute('data-late') || '0',
          paymentDate: targetRow.getAttribute('data-payment-date') || ''
        };
        
        document.getElementById('updateBillNo').value = currentData.billNo;
        document.getElementById('updateBillDate').value = currentData.billDate;
        document.getElementById('updateSubtotal').value = currentData.subtotal;
        document.getElementById('updateDiscAmount').value = currentData.discAmount;
        document.getElementById('updateTaxAmount').value = currentData.taxAmount;
        document.getElementById('updateLateCharges').value = currentData.lateCharges;
        document.getElementById('updateAmount').value = currentData.amount;
        document.getElementById('updateStatus').value = currentData.status;
        document.getElementById('updatePaymentDate').value = currentData.paymentDate;
        document.getElementById('updatePaymentMethod').value = currentData.paymentMethod;
        document.getElementById('updateGuestId').value = currentData.guestId;
        document.getElementById('updateStaffId').value = currentData.staffId;
        
        // Calculate initial total
        calculateTotal();
        
        document.getElementById('updateModal').setAttribute('data-target-row', billNo);
        document.getElementById('updateModal').style.display = 'block';
      }

      function calculateTotal() {
        const subtotal = parseFloat(document.getElementById('updateSubtotal').value) || 0;
        const discAmount = parseFloat(document.getElementById('updateDiscAmount').value) || 0;
        const taxAmount = parseFloat(document.getElementById('updateTaxAmount').value) || 0;
        const lateCharges = parseFloat(document.getElementById('updateLateCharges').value) || 0;
        const total = subtotal - discAmount + taxAmount + lateCharges;
        document.getElementById('updateAmount').value = total.toFixed(2);
      }
      
      // Set up event listeners for total calculation
      document.addEventListener('DOMContentLoaded', function() {
        const subtotalInput = document.getElementById('updateSubtotal');
        const discInput = document.getElementById('updateDiscAmount');
        const taxInput = document.getElementById('updateTaxAmount');
        const lateInput = document.getElementById('updateLateCharges');
        
        if (subtotalInput) subtotalInput.addEventListener('input', calculateTotal);
        if (discInput) discInput.addEventListener('input', calculateTotal);
        if (taxInput) taxInput.addEventListener('input', calculateTotal);
        if (lateInput) lateInput.addEventListener('input', calculateTotal);
      });

      function closeUpdateModal() {
        document.getElementById('updateModal').style.display = 'none';
        document.getElementById('updateBillForm').reset();
      }

      function viewBillDetails(billNo) {
        const rows = tableBody.querySelectorAll('tr');
        let targetRow = null;
        
        rows.forEach(row => {
          const idCell = row.querySelector('td:first-child');
          if (idCell && idCell.textContent.trim() === billNo) {
            targetRow = row;
          }
        });
        
        if (!targetRow) {
          alert('Bill not found!');
          return;
        }
        
        const cells = targetRow.querySelectorAll('td');
        const subtotal = parseFloat(targetRow.getAttribute('data-subtotal')) || 0;
        const discAmount = parseFloat(targetRow.getAttribute('data-disc')) || 0;
        const taxAmount = parseFloat(targetRow.getAttribute('data-tax')) || 0;
        const lateCharges = parseFloat(targetRow.getAttribute('data-late')) || 0;
        const paymentDate = targetRow.getAttribute('data-payment-date') || '';
        
        document.getElementById('detailsBillNo').value = cells[0].textContent.trim();
        document.getElementById('detailsBillDate').value = cells[1].textContent.trim();
        document.getElementById('detailsSubtotal').value = 'RM ' + subtotal.toLocaleString();
        document.getElementById('detailsDiscAmount').value = 'RM ' + discAmount.toLocaleString();
        document.getElementById('detailsTaxAmount').value = 'RM ' + taxAmount.toLocaleString();
        document.getElementById('detailsLateCharges').value = 'RM ' + lateCharges.toLocaleString();
        document.getElementById('detailsTotalAmount').value = cells[2].textContent.trim();
        const statusSelect = cells[3].querySelector('.status-select');
        document.getElementById('detailsBillStatus').value = statusSelect ? statusSelect.value : cells[3].textContent.trim();
        document.getElementById('detailsPaymentDate').value = paymentDate || 'Not paid yet';
        document.getElementById('detailsPaymentMethod').value = cells[4].textContent.trim();
        document.getElementById('detailsGuestId').value = cells[5].textContent.trim();
        document.getElementById('detailsStaffId').value = cells[6].textContent.trim();
        
        document.getElementById('detailsModal').style.display = 'block';
      }

      function closeDetailsModal() {
        document.getElementById('detailsModal').style.display = 'none';
      }

      document.getElementById('updateBillForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const billNo = document.getElementById('updateBillNo').value;
        const updatedData = {
          billDate: document.getElementById('updateBillDate').value,
          subtotal: parseFloat(document.getElementById('updateSubtotal').value),
          discAmount: parseFloat(document.getElementById('updateDiscAmount').value),
          taxAmount: parseFloat(document.getElementById('updateTaxAmount').value),
          lateCharges: parseFloat(document.getElementById('updateLateCharges').value),
          amount: parseFloat(document.getElementById('updateAmount').value),
          status: document.getElementById('updateStatus').value,
          paymentDate: document.getElementById('updatePaymentDate').value,
          paymentMethod: document.getElementById('updatePaymentMethod').value,
          guestId: document.getElementById('updateGuestId').value.trim(),
          staffId: document.getElementById('updateStaffId').value.trim()
        };
        
        const rows = tableBody.querySelectorAll('tr');
        rows.forEach(row => {
          const idCell = row.querySelector('td:first-child');
          if (idCell && idCell.textContent.trim() === billNo) {
            const cells = row.querySelectorAll('td');
            cells[1].textContent = updatedData.billDate;
            cells[2].textContent = 'RM ' + updatedData.amount.toLocaleString();
            
            // Update the status dropdown
            const statusSelect = cells[3].querySelector('.status-select');
            if (statusSelect) {
              statusSelect.value = updatedData.status;
              statusSelect.setAttribute('data-status', updatedData.status);
              // Update background color based on status
              if (updatedData.status === 'Paid') {
                statusSelect.style.background = '#e8f5e9';
                statusSelect.style.color = '#00bf63';
              } else {
                statusSelect.style.background = '#fff3e0';
                statusSelect.style.color = '#ff9800';
              }
            }
            
            cells[4].textContent = updatedData.paymentMethod;
            cells[5].textContent = updatedData.guestId;
            cells[6].textContent = updatedData.staffId;
            
            row.setAttribute('data-date', updatedData.billDate);
            row.setAttribute('data-amount', updatedData.amount);
            row.setAttribute('data-status', updatedData.status);
            row.setAttribute('data-subtotal', updatedData.subtotal);
            row.setAttribute('data-disc', updatedData.discAmount);
            row.setAttribute('data-tax', updatedData.taxAmount);
            row.setAttribute('data-late', updatedData.lateCharges);
            row.setAttribute('data-payment-date', updatedData.paymentDate || '');
            
            allRows = Array.from(tableBody.querySelectorAll('tr'));
            closeUpdateModal();
            alert('Bill details updated successfully!');
            return;
          }
        });
      });

      window.onclick = function(event) {
        const updateModal = document.getElementById('updateModal');
        const detailsModal = document.getElementById('detailsModal');
        if (event.target === updateModal) {
          closeUpdateModal();
        }
        if (event.target === detailsModal) {
          closeDetailsModal();
        }
      }

      function deleteBill(billNo) {
        if (confirm('Are you sure you want to delete bill ' + billNo + '?')) {
          const rows = tableBody.querySelectorAll('tr');
          rows.forEach(row => {
            const idCell = row.querySelector('td:first-child');
            if (idCell && idCell.textContent.trim() === billNo) {
              row.remove();
              allRows = Array.from(tableBody.querySelectorAll('tr'));
              alert('Bill deleted successfully!');
              return;
            }
          });
        }
      }

      function quickChangeStatus(billNo, newStatus) {
        const rows = tableBody.querySelectorAll('tr');
        rows.forEach(row => {
          const idCell = row.querySelector('td:first-child');
          if (idCell && idCell.textContent.trim() === billNo) {
            // Update the data-status attribute
            row.setAttribute('data-status', newStatus);
            
            // Update the select dropdown background color
            const statusSelect = row.querySelector('.status-select');
            if (statusSelect) {
              statusSelect.setAttribute('data-status', newStatus);
              if (newStatus === 'Paid') {
                statusSelect.style.background = '#e8f5e9';
                statusSelect.style.color = '#00bf63';
              } else {
                statusSelect.style.background = '#fff3e0';
                statusSelect.style.color = '#ff9800';
              }
            }
            
            // If changing to Paid and no payment date exists, set today's date
            if (newStatus === 'Paid' && !row.getAttribute('data-payment-date')) {
              const today = new Date().toISOString().split('T')[0];
              row.setAttribute('data-payment-date', today);
            }
            
            // If changing to Pending, clear payment date
            if (newStatus === 'Pending') {
              row.setAttribute('data-payment-date', '');
            }
            
            alert('Bill status updated to ' + newStatus + '!');
            return;
          }
        });
      }
    </script>
  </body>
</html>

