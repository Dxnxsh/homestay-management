<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../css/dashboardStyle.css">
    <link href='https://cdn.boxicons.com/3.0.5/fonts/basic/boxicons.min.css' rel='stylesheet'>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
   </head>
<body>
  <!-- Sidebar -->
  <div class="sidebar close">
    <div class="logo-details">
      <img src="../images/logo.png" alt="Serena Sanctuary logo" class="logo-icon">
      <span class="logo_name">Serena Sanctuary</span>
    </div>
    <ul class="nav-links">
      <li>
        <a href="dashboard.html">
          <i class='bxr  bx-dashboard'></i> 
          <span class="link_name">Dashboard</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="dashboard.html">Dashboard</a></li>
        </ul>
      </li>
      <li>
        <div class="icon-link">
          <a href="manage.html">
            <i class='bxr  bx-list-square'></i>
            <span class="link_name">Manage</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="manage.html">Manage</a></li>
          <li><a href="guests.html">Guests</a></li>
          <li><a href="staff.html">Staff</a></li>
          <li><a href="homestay.html">Homestay</a></li>
        </ul>
      </li>
      <li>
        <a href="billing.html">
          <i class='bxr  bx-print-dollar'></i>
          <span class="link_name">Billing</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="billing.html">Billing</a></li>
        </ul>
      </li>
      <li>
        <a href="bookings.html">
          <i class='bxr  bx-home-add'></i>
          <span class="link_name">Bookings</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="bookings.html">Bookings</a></li>
        </ul>
      </li>
      <li>
        <a href="calendar.html">
          <i class='bxr  bx-calendar-alt'></i> 
          <span class="link_name">Calendar</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="calendar.html">Calendar</a></li>
        </ul>
      </li>
      <li>
        <div class="icon-link">
          <a href="reports.html">
            <i class='bxr  bx-file-report'></i> 
            <span class="link_name">Reports</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="reports.html">Reports</a></li>
          <li><a href="fullReports.html">Full Reports</a></li>
          <li><a href="summary.html">Summary</a></li>
          <li><a href="analytics.html">Analytics</a></li>
        </ul>
      </li>
        <div class="profile-details">
          <div class="profile-content">
          <img src="../images/profile.png" alt="profileImg">
          <div class="name-job">
            <div class="profile_name">Shafiq</div>
            <div class="job">Admin</div>
          </div>
          <i class='bxr  bx-arrow-out-left-circle-half'></i> 
        </div>
      </li>
    </ul>
  </div>
  <section class="home-section">
    <!-- Header -->
    <div class="home-content">
      <i class='bx bx-menu' ></i>
      <span class="text">Serena Sanctuary</span>
    </div>
    <div class="page-heading">
      <h1>Dashboard</h1>
      <div class="date-card">
        <i class='bxr  bx-calendar-alt'></i>
        <div class="date-line" aria-live="polite">Loading dateâ€¦</div>
      </div>
    </div>
    <!-- Content -->
    <div class="content">
      <div class="content1">
        <a href="guests.html" class="sub-content1">
          <div class="subcard">
            <div class="subcard-number">
              67
            </div>
            <div class="subcard-text">
              Current Guests
            </div>
          </div>
          <i class='bxr  bxs-user'></i>
        </a>
        <a href="guests.html" class="sub-content1">
          <div class="subcard">
            <div class="subcard-number">
              8
            </div>
            <div class="subcard-text">
              New Guests
            </div>
          </div>
          <i class='bxr  bxs-user-plus'></i> 
        </a>
        <a href="staff.html" class="sub-content1"> 
          <div class="subcard">
            <div class="subcard-number">
              14
            </div>
            <div class="subcard-text">
              Total Staff
            </div>
          </div>
          <i class='bxr  bxs-community'></i>
        </a>
        <a href="bookings.html" class="sub-content1">
          <div class="subcard">
            <div class="subcard-number">
              69
            </div>
            <div class="subcard-text">
              Pending Bookings
            </div>
          </div>
          <i class='bxr  bxs-calendar-heart'></i> 
        </a>
        <a href="homestay.html" class="sub-content1">
          <div class="subcard">
            <div class="subcard-number">
              5
            </div>
            <div class="subcard-text">
              Total Homestay
            </div>
          </div>
          <i class='bxr  bxs-home-circle'></i> 
        </a>
      </div>
      <div class="content2">
        <div class="sub-content2-1">
          <canvas id="houseComparisonChart" aria-label="House occupancy comparison chart"></canvas>
        </div>
        <div class="sub-content2-2">
          <p>House Distribution</p>
          <div class="pie-chart-wrapper">
            <div class="pie-chart">
              <canvas id="housePieChart" aria-label="House distribution pie chart"></canvas>
            </div>
            <ul class="pie-legend" id="housePieLegend" aria-label="House legend"></ul>
          </div>
        </div>
      </div>
      <div class="content3">
        <div class="sub-content3-1">
          <p>Monthly Revenue</p>
          <div class="revenue-chart-container">
            <canvas id="monthlyRevenueChartOuter" aria-label="Current month revenue chart"></canvas>
            <canvas id="monthlyRevenueChartInner" aria-label="Last month revenue chart"></canvas>
            <div class="revenue-center-text">
              <div class="revenue-amount">RM <span id="totalRevenue">0</span></div>
              <div class="revenue-label">Current Month</div>
            </div>
          </div>
        </div>
        <div class="sub-content3-1">
          <p>Highest Month Bookings</p>
          <div class="highest-bookings-container">
            <img src="../images/calendarShape.png" alt="Calendar shape" class="calendar-shape-image">
            <div class="highest-bookings-content">
              <div class="highest-month-name" id="highestMonthName">Loading...</div>
              <div class="highest-bookings-count" id="highestBookingsCount">0</div>
              <div class="highest-bookings-label">Total Bookings</div>
            </div>
          </div>
        </div>
        <div class="sub-content3-2">
          <div class="revenue-line-chart-container">
            <canvas id="revenueLineChart" aria-label="Revenue by month line chart"></canvas>
          </div>
        </div>
      </div>
      <div class="content4">
        <div class="new-guests-table-container">
          <div class="table-header-row">
            <p>New Guests</p>
            <a href="guests.html" class="btn-manage">Manage Guests</a>
          </div>
          <table class="new-guests-table">
            <thead>
              <tr>
                <th>Guest ID</th>
                <th>Name</th>
                <th>Phone Number</th>
                <th>Gender</th>
                <th>Email</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>G001</td>
                <td>Ahmad bin Abdullah</td>
                <td>+6012-345-6789</td>
                <td>Male</td>
                <td>ahmad.abdullah@email.com</td>
                <td>Regular</td>
              </tr>
              <tr>
                <td>G002</td>
                <td>Siti Nurhaliza</td>
                <td>+6013-456-7890</td>
                <td>Female</td>
                <td>siti.nurhaliza@email.com</td>
                <td>VIP</td>
              </tr>
              <tr>
                <td>G003</td>
                <td>Lim Wei Ming</td>
                <td>+6014-567-8901</td>
                <td>Male</td>
                <td>lim.weiming@email.com</td>
                <td>Regular</td>
              </tr>
              <tr>
                <td>G004</td>
                <td>Fatimah binti Hassan</td>
                <td>+6015-678-9012</td>
                <td>Female</td>
                <td>fatimah.hassan@email.com</td>
                <td>Regular</td>
              </tr>
              <tr>
                <td>G005</td>
                <td>Tan Mei Ling</td>
                <td>+6016-789-0123</td>
                <td>Female</td>
                <td>tan.meiling@email.com</td>
                <td>VIP</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2025 Serena Sanctuary. All rights reserved.</p>
      </div>
    </footer>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  let arrow = document.querySelectorAll(".arrow");
  for (var i = 0; i < arrow.length; i++) {
    arrow[i].addEventListener("click", (e)=>{
   let arrowParent = e.target.parentElement.parentElement;//selecting main parent of arrow
   arrowParent.classList.toggle("showMenu");
    });
  }
  let sidebar = document.querySelector(".sidebar");
  let sidebarBtn = document.querySelector(".bx-menu");
  console.log(sidebarBtn);
  sidebarBtn.addEventListener("click", ()=>{
    sidebar.classList.toggle("close");
  });

  const dateLine = document.querySelector(".date-line");
  if (dateLine) {
    const now = new Date();
    const format = new Intl.DateTimeFormat("en-GB", { day: "numeric", month: "long", year: "numeric" });
    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    dateLine.textContent = `${format.format(monthStart)} - ${format.format(monthEnd)}`;
  }

  const chartCanvas = document.getElementById("houseComparisonChart");
  if (chartCanvas) {
    const houseLabels = ["House 1", "House 2", "House 3", "House 4", "House 5"];
    const currentMonthValues = [18, 22, 15, 27, 19];
    const pieColors = ["#00bf63", "#ffde59", "#38b6ff", "#8c52ff", "#ff3131"];

    new Chart(chartCanvas, {
      type: "bar",
      data: {
        labels: houseLabels,
        datasets: [
          {
            label: "Current Month",
            data: currentMonthValues,
            backgroundColor: "#00bf63",
            barThickness: 24,
          },
          {
            label: "Last Month",
            data: [24, 28, 20, 30, 24],
            backgroundColor: "#d9d9d9",
            barThickness: 24,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "top",
            labels: {
              boxWidth: 12,
              usePointStyle: true,
            },
          },
        },
        scales: {
          x: {
            grid: {
              display: false,
            },
          },
          y: {
            beginAtZero: true,
            grid: {
              color: "rgba(0,0,0,0.05)",
            },
          },
        },
      },
    });

    const pieCanvas = document.getElementById("housePieChart");
    const pieLegend = document.getElementById("housePieLegend");

    if (pieCanvas) {
      new Chart(pieCanvas, {
        type: "pie",
        data: {
          labels: houseLabels,
          datasets: [{
            data: currentMonthValues,
            backgroundColor: pieColors,
            borderColor: "#ffffff",
            borderWidth: 2,
          }],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false,
            },
          },
        },
      });
    }

    if (pieLegend) {
      pieLegend.innerHTML = houseLabels.map((label, index) => `
        <li>
          <span class="legend-dot" style="background-color:${pieColors[index]}"></span>
          <div class="legend-info">
            <strong>${label}</strong>
            <span>${currentMonthValues[index]} guests</span>
          </div>
        </li>
      `).join("");
    }
  }

  // Monthly Revenue Double Circle Chart
  const monthlyRevenueOuterCanvas = document.getElementById("monthlyRevenueChartOuter");
  const monthlyRevenueInnerCanvas = document.getElementById("monthlyRevenueChartInner");
  const totalRevenueSpan = document.getElementById("totalRevenue");
  
  if (monthlyRevenueOuterCanvas && monthlyRevenueInnerCanvas) {
    // Sample data - replace with actual data
    const currentMonthRevenue = 125000;
    const lastMonthRevenue = 110000;
    
    // Update the center text with current month revenue
    if (totalRevenueSpan) {
      totalRevenueSpan.textContent = currentMonthRevenue.toLocaleString();
    }

    // Calculate max value for scaling (use the larger value)
    const maxValue = Math.max(currentMonthRevenue, lastMonthRevenue) * 1.2;
    
    // Outer ring - Current Month
    new Chart(monthlyRevenueOuterCanvas, {
      type: 'doughnut',
      data: {
        datasets: [{
          label: 'Current Month',
          data: [currentMonthRevenue, maxValue - currentMonthRevenue],
          backgroundColor: ['#00bf63', 'rgba(0, 191, 99, 0.15)'],
          borderWidth: 0,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: false,
          },
          tooltip: {
            enabled: true,
            callbacks: {
              label: function(context) {
                if (context.dataIndex === 0) {
                  return 'Current Month: RM ' + currentMonthRevenue.toLocaleString();
                }
                return '';
              },
              filter: function(tooltipItem) {
                return tooltipItem.dataIndex === 0;
              }
            }
          }
        },
        cutout: '75%',
      }
    });
    
    // Inner ring - Last Month (scaled smaller to appear inside)
    new Chart(monthlyRevenueInnerCanvas, {
      type: 'doughnut',
      data: {
        datasets: [{
          label: 'Last Month',
          data: [lastMonthRevenue, maxValue - lastMonthRevenue],
          backgroundColor: ['#38b6ff', 'rgba(217, 217, 217, 0.15)'],
          borderWidth: 0,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: false,
          },
          tooltip: {
            enabled: true,
            callbacks: {
              label: function(context) {
                if (context.dataIndex === 0) {
                  return 'Last Month: RM ' + lastMonthRevenue.toLocaleString();
                }
                return '';
              },
              filter: function(tooltipItem) {
                return tooltipItem.dataIndex === 0;
              }
            }
          }
        },
        cutout: '80%',
      }
    });
  }

  // Highest Month Bookings
  const highestMonthName = document.getElementById("highestMonthName");
  const highestBookingsCount = document.getElementById("highestBookingsCount");
  
  if (highestMonthName && highestBookingsCount) {
    // Sample booking data - replace with actual data from your API/database
    // Format: { year: { month: bookingCount } }
    const bookingsByMonth = {
      2024: {
        0: 45,   // January
        1: 52,   // February
        2: 48,   // March
        3: 61,   // April
        4: 58,   // May
        5: 67,   // June
        6: 73,   // July (highest)
        7: 65,   // August
        8: 59,   // September
        9: 54,   // October
        10: 49,  // November
        11: 42   // December
      }
    };
    
    // Find the month with the highest bookings
    let highestBookings = 0;
    let highestMonthIndex = 0;
    let highestYear = 2024;
    
    // Check all years and months
    for (const year in bookingsByMonth) {
      for (const month in bookingsByMonth[year]) {
        const count = bookingsByMonth[year][month];
        if (count > highestBookings) {
          highestBookings = count;
          highestMonthIndex = parseInt(month);
          highestYear = parseInt(year);
        }
      }
    }
    
    // Format month name
    const monthNames = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    
    const highestMonthNameText = monthNames[highestMonthIndex];
    
    // Update the display
    highestMonthName.textContent = highestMonthNameText;
    highestBookingsCount.textContent = highestBookings;
  }

  // Revenue-Month Line Chart
  const revenueLineChartCanvas = document.getElementById("revenueLineChart");
  
  if (revenueLineChartCanvas) {
    const currentYear = new Date().getFullYear();
    const lastYear = currentYear - 1;
    
    // Month labels
    const monthLabels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    
    // Sample revenue data - replace with actual data from your API/database
    const currentYearRevenue = [95000, 105000, 98000, 112000, 118000, 125000, 132000, 128000, 120000, 115000, 108000, 102000];
    const lastYearRevenue = [88000, 92000, 85000, 98000, 105000, 110000, 118000, 115000, 108000, 102000, 95000, 90000];
    
    new Chart(revenueLineChartCanvas, {
      type: "line",
      data: {
        labels: monthLabels,
        datasets: [
          {
            label: currentYear.toString(),
            data: currentYearRevenue,
            borderColor: "#00bf63",
            backgroundColor: "rgba(0, 191, 99, 0.1)",
            borderWidth: 3,
            fill: false,
            tension: 0,
            pointRadius: 4,
            pointHoverRadius: 6,
            pointBackgroundColor: "#00bf63",
            pointBorderColor: "#fff",
            pointBorderWidth: 2,
          },
          {
            label: lastYear.toString(),
            data: lastYearRevenue,
            borderColor: "#ff3131",
            backgroundColor: "rgba(255, 49, 49, 0.1)",
            borderWidth: 3,
            fill: false,
            tension: 0,
            pointRadius: 4,
            pointHoverRadius: 6,
            pointBackgroundColor: "#ff3131",
            pointBorderColor: "#fff",
            pointBorderWidth: 2,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "top",
            labels: {
              boxWidth: 12,
              usePointStyle: true,
              padding: 15,
              font: {
                size: 12,
              },
            },
          },
          tooltip: {
            mode: "index",
            intersect: false,
            callbacks: {
              label: function(context) {
                return context.dataset.label + ": RM " + context.parsed.y.toLocaleString();
              },
            },
          },
        },
        scales: {
          x: {
            grid: {
              display: false,
            },
            ticks: {
              font: {
                size: 11,
              },
            },
          },
          y: {
            beginAtZero: false,
            grid: {
              color: "rgba(0,0,0,0.05)",
            },
            ticks: {
              callback: function(value) {
                return "RM " + (value / 1000) + "k";
              },
              font: {
                size: 11,
              },
            },
          },
        },
        interaction: {
          mode: "nearest",
          axis: "x",
          intersect: false,
        },
      },
    });
  }
  </script>
</body>
</html>